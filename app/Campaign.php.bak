<?php

namespace App;

use Illuminate\Database\Eloquent\Model;
use App\Traits\Tableable;
use App\Traits\Quasarable;
use App\Traits\Scope;

class Campaign extends Model
{
    use Tableable;
    use Quasarable;
    use Scope;

    protected $fillable = ['name', 'description', 'starts_at', 'ends_at'];
    // protected $with = ['campaign_posters', 'campaign_poster_priorities'];
    public static $full = ['campaign_posters', 'campaign_poster_priorities', 'sanitary_codes'];
    protected $appends = ['label', 'value'];

    // Quasar DATA
    protected $relations = ['campaign_posters', 'campaign_poster_priorities', 'sanitary_codes'];

    protected $quasarFormNewLayout = [
        [
            'title' => 'Información',
            'subtitle' => 'General',
            'fields' => [
                ['name','description', 'starts_at', 'ends_at']
            ],
        ],
    ];
    protected $quasarFormUpdateLayout = [
        [
            'title' => 'Información',
            'subtitle' => 'General',
            'fields' => [
                ['name', 'description', 'starts_at', 'ends_at']
            ],
        ],
        [
            'title' => 'Carteles',
            'icon' => 'photo_album',
            'fields' => [],
            'relations' => ['campaign_posters']
        ],
        [
            'title' => 'Priorities',
            'icon' => 'shuffle',
            'fields' => [],
            'relations' => ['campaign_poster_priorities']
        ],
        [
            'title' => 'Códigos Sanitarios',
            'icon' => 'spellcheck',
            'fields' => [],
            'relations' => ['sanitary_codes']
        ],
    ];
    protected $quasarFormFields = [
        'name' => [
            'label' =>'Nombre',
        ],
        'description' => [
            'label' =>'Descripción',
        ],
        'starts_at' => [
            'label' =>'Fecha Inicio',
            'type' => [
                'name' => 'date',
            ]
        ],
        'ends_at' => [
            'label' =>'Fecha Fin',
            'type' => [
                'name' => 'date',
            ]
        ]
    ];
    protected $listFields = [
        'left' => [],
        'main' => [
            'name' => ['text'],
        ],
        'right' => [
            'description' => ['text'],
        ],
    ];
    protected $keyField = 'name';
    // END Quasar DATA

    // Tableable DATA
    protected $tableColumns = [
        'name' => [
            'label' => 'Nombre',
            'filtering' => ['search'],
        ],
        'description' => [
            'label' => 'Descripción',
            'filtering' => ['search'],
        ],
        'starts_at' => [
            'label' => 'Fecha Inicio',
        ],
        'ends_at' => [
            'label' => 'Fecha Fin',
        ],
        'sanitary_codes_count' => [
            'label' => 'Códigos Sanitarios'
        ],
        'campaign_poster_priorities_count' => [
            'label' => 'Modelos de Cartel'
        ],
        'campaign_posters_count' => [
            'label' => 'Carteles'
        ],
        'actions' => [
            'label' => 'Actions'
        ]
    ];
    protected $tableOptions = [['show', 'edit', 'clone', 'delete'], true, true];
    // END Table Data

    public function campaign_poster_priorities () {
        return $this->hasMany(CampaignPosterPriority::class);
    }
    public function campaign_posters () {
        return $this->hasMany(CampaignPoster::class);
    }
    public function getCampaignPostersCountAttribute () {
        return $this->campaign_posters()->count();
    }
    public function clinic_poster_priorities () {
        return $this->hasMany(ClinicPosterPriority::class);
    }
    public function clinic_poster_distribution () {
        return $this->hasMany(ClinicPosterDistribution::class);
    }
    public function sanitary_codes () {
        return $this->hasMany(SanitaryCode::class);
    }
}
